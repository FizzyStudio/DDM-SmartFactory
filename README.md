
# DDM-Smart Factory 

数据驱动制造-智慧工厂系统方案讨论

Data Driven Manufacturing. Smart Factory System Plan Design. 

- 智慧工厂系统架构设计思路

---

### 智慧工厂系统架构设计思路

##### 产品（产品型号）

- 产品型号
   * 产品的唯一ID

- 产品信息
   * 生产的产品描述、所需的原料信息等

- 生产计划
   * 一个产品型号对应多个生产计划（生产任务），每个生产计划都会规定生产和结束的时间，生产的数量等信息
   * 多个生产计划在时间上可以重叠，即同一时间段内，有多个该产品型号的生产计划在执行

- 工序组
  * 一个产品型号可能对应多个工序列表（工序组），每个工序组都会规定需要执行的工艺和相互之间的顺序关系 

##### 生产计划（生产任务）

- 生产计划（生产任务）编号
   * 唯一的ID，可以反推对应的产品型号ID
   * 与产品型号ID的关系
      + 同一个产品型号ID，可以有多个不同的生产计划ID，即使是在同一时间段内
   * 与工序组ID的关系
      + 一个生产计划，只能对应一个工序组ID，该工序组ID在新建生产计划时绑定
      + 在生产计划未执行前，可以修改使用的工序组，但在生产计划执行后（包括暂停状态），无法变更使用的工序组
      + 工序组ID是与产品型号ID对应的，多个生产计划中，往往会使用同一个工序组ID

- 生产计划所包含的信息
   * 本次生产计划的产量/实际完成的产量、计划开始时间/结束时间、实际开始时间和结束时间等
   * ~~本次生产计划针对的目标客户~~
   * 生产计划的状态：未公布、公布但未开始、进行中、已完成、已暂停、已取消等

- 工序组
   * 一个生产计划对应着唯一的一个工序列表（工序组），工序组代表了在该生产计划中，产品的加工组装检测的顺序
   * 每次新建一个生产计划时，都需要唯一的绑定一个工序组
   * 在生产计划处于未公布、公布但未开始的状态时，可以修改生产计划，包括修改工序组内容
   * 一旦生产计划开始执行，包括进行中、已完成、已暂停、已取消等状态，则无法再修改生产计划，也无法修改工序组

##### 工序列表（工序组）

- 工序列表（工序组）编号
   * 唯一的ID
   * 工序组定义了某种产品型号的加工、组装、检测顺序
   * 工序组ID是针对产品型号ID而言的，不同的产品型号必然使用不同的工序组ID
   
- 工序列表（工序组）信息
   * 每次新建一个生产计划时，都需要唯一的绑定一个工序组
   * 工序组可用户自定义，实现串行工序、并行工序和混合工序

- 工序
   * 一个工序列表（工序组）包含多个工序，工序之间存在串行和并行的关系
   * 串行工序
      + 串行工序之间有不同的优先级，存在依赖关系，必须先完成之前的才能完成后面的，即必须按顺序完成
   * 并行工序
      + 并行工序具有相同的优先级，没有依赖关系，可同时开展
   * 混合工序
      + 混合工序同时包含了串行和并行两者工序

##### 工序

- 工序编号
   * 唯一的ID
   * 与工序组ID的联系和区别
      + 多个工序ID通过串联、并联、串并联混合的形式，组合在一起，组成了工序组
      + 工序组ID可知对应的产品型号ID，通过生产计划ID可知产品型号ID和工序组ID，因此工序组ID和生产计划ID是产品型号相关的
      + 不同的工序组ID可能包含相同的工序ID，而这些工序组ID可能是同一个产品型号ID下的，也可能是不同的产品型号ID下的
      + 也就是说，不同的产品型号生产过程中，都可能包含同一道工序，因此工序ID是产品型号无关的

- 工序包含的信息
   * 该工序完成的工作内容描述，工作内容至少是一项，也可以有多项
   * 通常分为组装工序、检测工序或两者混合
      + 对于组装型工序，组装前扫码一次，表示开始组装，完成后扫码一次，表示完成组装
      + 对于检测工序，检测前扫码一次，表示开始检测，检测到数据后，再扫码一次表示完成检测
      + 有些场景下，可能只扫描一次，这需要根据具体场景确定

- 工位（站点）
   * 工位（站点）负责工序内容的具体执行
   * 一个工序ID可以有多个工位（站点），不同的工位完成相同的工作内容
   * 一个工位可能是全自动的、也可能是有工作人员的，工作人员可能是一个，也可能有多个
   
##### 工位（站点）

- 工位（站点）编号
   * 唯一的ID
   * 一个工序ID可以有多个工位（站点），不同的工位完成相同的工作内容
   * 一个工位可能是全自动的、也可能是有工作人员的，工作人员可能是一个，也可能有多个

##### 组装品

- 组装品编号
   * 唯一的ID
   * 组装品指的是正在组装生产检测中的产品，经过产线组装检测后入库，最终卖给客户
   * 组装品ID是最终面向客户的，通过组装品ID，应能查询到以下信息
      + 产品型号ID
      + 生产计划ID
      + 工序组ID
      + 各工序ID，其实际执行的工位ID，操作人员，执行时间信息
      + 若组装品的配件本身也包含ID，则还应包含配件的ID信息

- ~~生产批号~~
   * ~~小型的组装品，往往多个放置在同一个盒子或箱子里封装起来，这一个盒子或箱子对应着一个编号，叫做生产批号~~


---
### 数据库设计思路 - DB Sehema

##### 产品 - product

- product_id
   * 产品类型ID，唯一
   * VARCHAR

- product_name
   * 产品名称

- product_desc
   * 产品描述
 
 - create_time
   * 产品类型的创建时间      
      
- update_time
   * 产品信息的更新时间

##### 生产计划清单（列表） - work_plan_list

- plan_list_id
   * 生产计划ID

- plan_id_count
  * 包含的生产计划数量

##### 生产计划 - work_plan

- plan_id
   * 生产计划项ID

- plan_list_id
   * 隶属于哪个生产计划列表

- plan_desc
   * 该生产计划的相关描述

- product_id
   * 该生产计划计划生产的产品类型ID

- procedure_group_id
   * 该生产计划使用的工序组ID

- plan_output
   * 计划的产量

- actual_output
   * 实际的产量

- plan_status
   * 描述生产计划的进展状态
      + unpublished：未公布
      + ongoing：进行中
      + cancelled：已取消（v1.0暂不考虑）
      + suspend：已暂停（v1.0暂不考虑）
      + finished：已结束，不管是否完成

- plan_result
   * 描述生产计划的完成状态
      + exceed_done：超额完成
      + incompleted：未完成，但已结束
      + done：完成

- plan_start_time
   * 计划的开始时间

- plan_finish_time
   * 计划的结束时间

- actual_start_time
   * 时间开始的时间

- actual_finish_time
   * 实际结束的时间

- create_time
   * 创建时间      
      
- update_time
   * 更新时间

##### 工序组 procedure_group

- group_id
   * 工序组ID

- group_name
   * 工序组名称

- product_id
   * 对应的产品类型ID

- procedure_bitmap
   * 所有用到的工序ID做与运算

- procedure_sequence
   * json格式存储所有用到的工序ID的顺序
   * {1:c, 2:b, 3:e, 4:a, ...}

##### 工序 - work_procedure

- procedure_id
   * 工序ID，唯一
   * 每个procedure只占用1bit位

- procedure_name
   * 工序名，用于对外显示

- procedure_desc
   * 工序的描述

- procedure_property
   * 描述工序的属性
      + 该工序是否是头工序？不是；可以是也可以不是；必须是
      + 该工序是否是尾工序？不是；可以是也可以不是；必须是
      + 该工序是否是抽检工序？不是；可以是也可以不是；必须是
      + 该工序需要扫码次数？0,1,2...
      + 是否支持多生产计划同时处理？
      + 是否支持暂停和恢复功能？

- procedure_status
   * 描述工序当前的状态
      + idle：所有正在进行的生产计划都没有用到当前工序（v1.0支持）
      + busy：正在进行的生产计划中有用到当前工序（v1.0支持）
      + suspend：正在进行的生产计划中有用到当前工序，但由于某种原因暂停中（v1.0暂时不考虑）
      + not configured：当前工序没有配置好，不能使用（v1.0暂时不考虑）

- work_site_count
   * 当前工序包含的工位数

- procedure_help
   * 工序指导说明链接

- create_time
   * 工序的创建时间      
      
- update_time
   * 工序的更新时间

-  v1.0版本默认以下属性
   *  每个工序都默认支持多生产计划处理
   *  新建生产计划（工序组）时，默认只指定用到哪些工序，不具体到工序下的工位，用到的工序下的默认工位都视为参与该生产计划（工序组）
   *  不考虑工序的暂停和恢复功能

##### 工位 - work_site

- site_id
   * 工位的ID，唯一，自增

- procedure_id
   * 工序的ID，当前工位隶属于哪个工序

- site_index
   * 一个工序可能配置多个工位，表示当前工位在所属的工序下的索引号

- site_name
   * 工位的中文名：一般等于工序名+索引号

- site_property
   * 描述工位的属性
      + 是否支持多生产计划同时处理？
      + 是否支持暂停和恢复功能？
      + 工位是否绑定操作人员？只有负责人员有操作权限？
      + 工位是否绑定设备？绑定设备的工位才可以作业？

- site_status
   * 工位当前的状态
      + idle：所有正在进行的生产计划中没有用到当前工位
      + busy：正在进行的生产计划中有使用当前工位
      + suspend：正在进行的生产计划中有使用当前工位，但由于某种原因暂停中（暂时不考虑）
      + not configured：当前工位没有配置好，不能使用（暂时不考虑）

- site_desc
   * 工位工作内容的描述

- create_time
   * 工位的创建时间      
      
- update_time
   * 工位的更新时间

-  v1.0版本默认以下属性
   *  每个工位都默认支持多个生产计划的组装品在同一个工位上同时处理
   *  新建生产计划（工序组）时，默认只指定用到哪些工序，不具体到工序下的工位，用到的工序下的默认工位都视为参与该生产计划（工序组）
   *  不考虑设备绑定和解绑的功能
   *  不考虑操作人员绑定和解绑的功能
   *  不考虑暂停和恢复功能
